---
title: "What to Expect with Life Expectancy?"
subtitle: "Examining How Healthcare Expenditure, Education, and Medical Infrastructure Influence Life Expectancy Across Developed and Developing Regions"
author: 
  - Manjun Zhu
thanks: "Code and data are available at: [https://github.com/Karrrrmen/Life_Expectancy](https://github.com/Karrrrmen/Life_Expectancy)."
date: today
date-format: long
abstract: "Life expectancy has seen unprecedented growth in recent decades, driven by advancements in healthcare, improved access to medical services, and reduced child mortality. However, this growth has not been evenly distributed across the globe, with wealthier nations benefiting disproportionately. This research examines the impact of a nation’s educational standing and health conditions on life expectancy, exploring potential variables beyond those traditionally studied. By developing a linear model, the analysis identifies key relationships between education and healthcare indicators and their influence on population longevity. The findings aim to inform health policy and education planning, providing actionable insights to address disparities and promote equitable growth in life expectancy worldwide."
format: pdf
toc: true
toc-depth: 3
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

# load libraries
library(dplyr)
library(tidyverse)
library(here)
library(arrow)
library(ggplot2)
library(knitr)
library(kableExtra)
library(modelsummary)
library(ggbeeswarm)
library(ggridges)
library(broom)

# load data
data <- read_parquet(here::here("data/02-analysis_data/analysis_data.parquet"))

```


# Introduction

Life expectancy has witnessed remarkable growth over the past century, driven by advancements in healthcare, improved access to medical services, and reduced child mortality rates. However, this progress has not been distributed equitably across the globe. While nations with robust economies and developed healthcare systems have achieved significant gains, others, particularly in underdeveloped regions, continue to face barriers such as inadequate infrastructure, persistent diseases, and economic instability. Despite existing research on life expectancy determinants, gaps remain in understanding the nuanced relationships between economic standing, healthcare access, and other critical variables.

This study aims to examine the factors influencing life expectancy across different nations by developing a linear regression model that incorporates both healthcare and education variables. The response variable in the analysis is life expectancy, while the predictors include national status (Developed vs. Developing), diphtheria immunization coverage, government healthcare expenditure as a percentage of total expenditure, and the number of doctors and nurses per 10,000 people. Additionally, schooling is considered as an important educational factor. By quantifying the effects of these predictors, the study seeks to shed light on disparities in life expectancy between developed and developing nations, and to identify key factors contributing to these differences. Through this analysis, we aim to contribute valuable insights for policy development focused on improving healthcare and economic outcomes.

Previous studies provide valuable context for this research. One study [@Garon2015] examined the long-term effects of diphtheria on survivors, revealing that paralyzed individuals experience greater reductions in life expectancy, which underscores the importance of healthcare infrastructure in mitigating preventable diseases in underdeveloped regions. Another study extended this understanding by exploring the role of the Human Development Index (HDI), emphasizing the influence of public health initiatives, economic conditions, and education on life expectancy in low and medium-HDI nations [@Girum2018]. Besides that, developed econometric techniques, including panel cointegration analysis, have demonstrated a positive relationship between health care expenditure per capita and life expectancy, providing a robust foundation for integrating economic variables into this study [@He2020]. Additionally, a finding [@Hanushek2016] underscored the importance of combining both educational investments and government support in improving life expectancy, particularly in developing regions. The strong correlation between education and health suggests that higher levels of education improve overall health, reducing mortality rates and extending life expectancy.

The analysis reveals that life expectancy in developed countries is generally higher and more stable, attributed to stronger healthcare systems, consistent access to medical services, and robust economic stability. These factors are typically supported by well-established public health policies. In contrast, life expectancy in developing countries demonstrates a broader range of variation, though with a noticeable upward trend. This improvement is driven by diverse factors like better healthcare access, economic development, and increasing resource availability, but the inconsistency across regions highlights disparities in infrastructure. The faster growth trajectory in these nations indicates progress, yet challenges remain in achieving stable health outcomes. These findings suggest that policymakers in developing countries should prioritize healthcare system strengthening, resource access, and reducing regional inequalities, while in developed countries, maintaining consistent healthcare access and supporting sustained economic growth should remain priorities.

The remainder of this paper is structured as follows: Section @sec-data discusses the data sources and cleaning methods, followed by an analysis of key predictors in Section @sec-model. Section @sec-results presents the findings from the linear regression model, and Section @sec-discussion explores the implications of these findings, concluding with recommendations for policy interventions and areas for future research.


# Data {#sec-data}

## Overview

This study utilizes two primary datasets related to global health and life expectancy. The first dataset, Life Expectancy and Healthy Life Expectancy [@world_health_statistics], provides comprehensive global health data, including variables such as GDP, life expectancy, mortality rates, and access to healthcare. The second dataset, Life Expectancy (WHO) [@life_expectancy_who], focuses specifically on life expectancy trends and factors, offering a detailed breakdown by country, year, and socioeconomic variables.

Together, these datasets enable an in-depth exploration of the relationships between life expectancy and various predictors, such as economic indicators, healthcare access, and immunization coverage. Key variables include Life Expectancy, Status (Developed vs. Developing), Diphtheria Immunization Coverage, Government Health Expenditure as percentage of Total Expenditure, Numbers of Doctors and Nurses per 10000, and Schooling.

We performed data cleaning and analysis using R [@citeR], incorporating a range of packages for efficient data manipulation, visualization, and statistical modeling, leveraging packages such as **`tidyverse`** for data manipulation and visualization [@tidyverse], **`dplyr`** for streamlined data wrangling [@dplyr], **`ggplot2`** for creating high-quality plots [@ggplot2], **`ggridges`** for displaying the distribution of variables across different categories with ridge plots [@ggridges], **`ggbeeswarm`** for visualizing the distribution of data points with swarming plots [@ggbeeswarm], **`here`** for managing file paths [@here], **`lubridate`** for handling date-related variables [@lubridate], **`arrow`** for data storage and processing [@arrow], **`kableExtra`** for generating polished tables [@kableExtra], **`modelsummary`** for summarizing model results [@modelsummary],  **`broom`** for tidying up model outputs into easily readable data frames [@broom], and **`knitr`** for dynamic report generation and the integration of code with results in reproducible workflows [@knitr].


## Measurement
	
The measurement process explains how real-world phenomena—such as healthcare access, economic indicators, or demographic factors—are translated into structured data entries. Each row in the dataset represents a specific country in a given year, capturing various variables related to life expectancy and its determinants. These variables originate from data collection efforts by global organizations like the World Health Organization (WHO), which rely on surveys, national health systems, and standardized reporting frameworks to compile accurate and comparable statistics across countries. Below is a description of key variables in the dataset:

**Life Expectancy (`LifeExpectancy`)**: This is the dependent variable, representing the average number of years a person is expected to live from birth, assuming current mortality rates. The data is reported by international organizations like the World Health Organization (WHO) and is recorded in numeric format as age in years.

**Status (`Status`)**: This categorical variable identifies whether a country is classified as "Developed" or "Developing." The classification is based on economic and social indicators defined by the World Health Organization (WHO) or related agencies.

**Percentage of Health Expenditure (`HealthExpenditure`)**: This represents the general government expenditure on health as a percentage of total government expenditure. It is reported by national governments or international organizations and recorded as a percentage in the dataset.

**Diphtheria Immunization Coverage (`Diphtheria`)**: This variable reflects the percentage of one-year-olds who have received the DTP3 vaccine (diphtheria, tetanus toxoid, and pertussis). Immunization data is typically gathered through health system reports or household surveys and is recorded as a numeric percentage.

**Schooling (`Schooling`)**: This measures the average number of years of schooling for individuals in the population. Data on schooling is sourced from education ministry reports or international databases like UNESCO, and it is recorded in years as a numeric value.

**Medical Doctors (`pct_doctor`)**: This variable represents the number of medical doctors per 10,000 people in the population. It is typically reported by national health ministries or equivalent institutions. The dataset standardizes this figure as a numeric value to facilitate cross-country comparisons.

**Nursing and Midwifery Personnel (`pct_nursing`)**: This measures the number of nursing and midwifery personnel per 10,000 people in the population. It is collected through similar national reporting systems and is recorded as a numeric value.


## Data Cleaning

The raw Life Expectancy dataset, along with two supplementary datasets for medical doctors and nursing personnel, underwent several cleaning steps to ensure it was accurate, consistent, and ready for analysis. Initially, the columns in the supplementary datasets were renamed for clarity and compatibility with the main dataset. A left join was then performed to merge information on `pct_doctor` and `pct_nursing` into the main dataset. Subsequently, the data was filtered to include only entries from 2004 to 2015, and rows with missing values were removed to maintain data integrity. Column names were standardized, and data types were adjusted as necessary to ensure compatibility with analytical processes. The cleaned dataset was then saved as a Parquet file for efficient storage and further analysis.


## Outcome Variables
The outcome variable is Life Expectancy. It represents the average number of years a person is expected to live, based on current health conditions and mortality rates. The model aims to understand how various factors, such as healthcare availability, education, and economic status, influence life expectancy across different countries. @fig-response displays the historical data of life expectancy across 195 countries from 2004 to 2015, comparing developed and developing countries. The data reveals distinct trends in life expectancy, with developed countries generally experiencing higher life expectancy compared to their developing counterparts.

```{r}
#| label: fig-response
#| fig-cap: "The distribution highlights the frequency of life expectancy values across the dataset. The distribution is slightly right-skewed, with a mean around 73 years, reflecting the overall health trends captured in the data."
#| echo: false
#| warning: false
#| message: false

ggplot(data, aes(x = LifeExpectancy)) +
  geom_histogram(aes(y = ..density..), 
                 bins = 70, fill = "#433769", color = "white", alpha = 0.7) +
  geom_density(color = "#8980a8", fill = "#d0c7eb", alpha = 0.6) +
  labs(
    title = "Distribution of Life Expectancy",
    x = "Life Expectancy", y = "Frequency"
  ) +
  theme_minimal() 

```
\newpage

## Predictor Variables

The predictor variables (or independent variables) are the factors believed to influence life expectancy:

1. **Status (`Status`)**: This variable categorizes countries into "Developed" and "Developing" groups. The development status of a country plays a significant role in determining life expectancy, with developed countries generally having higher life expectancies due to better healthcare, sanitation, and infrastructure, as depicted in @fig-status.

2. **Diphtheria Immunization Coverage (`Diphtheria`)**: This variable represents the percentage of one-year-olds who have received the Diphtheria, Tetanus, and Pertussis (DTP3) immunization. Immunization coverage[@fig-diphtheria] is an important health indicator, as it reflects the effectiveness of a country's healthcare system in preventing infectious diseases, which in turn affects life expectancy.

3. **Schooling (`Schooling`)**: The number of years of schooling in a country is used as a proxy for education levels. Higher education levels typically correlate with better health outcomes and, consequently, higher life expectancy, as educated individuals are more likely to engage in healthier behaviors and have access to better healthcare. The Educated condition is shown in @fig-schooling.

4. **Medical Doctors (`pct_doctor`)**: This variable indicates the number of medical doctors per 10,000 people[@fig-doctor]. Access to healthcare professionals is a key determinant of health outcomes, and a higher number of doctors generally corresponds with better healthcare services and longer life expectancy.

5. **Nursing and Midwifery Personnel (`pct_nursing`)**: Similar to the number of doctors, this variable represents the number of nursing and midwifery personnel per 10,000 population[@fig-nursing]. Nurses play a significant role in delivering healthcare, and higher availability of nursing staff can contribute to improved health outcomes and increased life expectancy.

7. **Percentage of Health Expenditure (`HealthExpenditure`)**: This variable reflects the general government expenditure on health as a percentage of total government expenditure, as shown in @fig-totalExpenditure. Higher health spending is often associated with better healthcare infrastructure, which can lead to longer life expectancy due to better disease prevention and treatment options.

```{r}
#| label: fig-status
#| fig-cap: "The distribution of Status shows the counts of developed and developing countries in the dataset. There are 305 data points from developed countries and 788 from developing countries."
#| echo: false
#| warning: false
#| message: false

ggplot(data, aes(x = Status, fill = Status)) +
  geom_bar(stat = "count") +
  labs(x = "Country Status", 
       y = "Frequency", 
       title = "Distribution of Countries by Status (Developed vs Developing)") +
  scale_fill_manual(values = c("#b3685d", "#a85b6a")) +
  theme_minimal() +
  theme(legend.position = "none")
```

```{r}
#| label: fig-diphtheria
#| fig-cap: "The distribution of immunization coverage for diphtheria reveals that immunization coverage is generally high, with most countries achieving high vaccination rates. However, there is some variance, reflecting disparities in immunization efforts across different regions."
#| echo: false
#| warning: false
#| message: false

data_clean <- data %>%
  filter(!is.na(Diphtheria) & Diphtheria > 0)

ggplot(data_clean, aes(x = Diphtheria)) +
  geom_histogram(aes(y = ..density..), 
                 bins = 70, fill = "#4d1f0a", color = "white", alpha = 0.7) +
  labs(
    title = "Distribution of Immunization Coverage of Diphtheria",
    x = "Immunization Coverage of Diphtheria", y = "Frequency"
  ) +
  theme_minimal() 


```


```{r}
#| label: fig-schooling
#| fig-cap: "The distribution of Schooling Years is shown as a representation of the Education Factor, the distribution of schooling years across the dataset approaches a normal distribution"
#| echo: false
#| warning: false
#| message: false

data_clean <- data %>%
  filter(!is.na(Schooling) & Schooling > 0)

ggplot(data_clean, aes(x = Schooling)) +
  geom_histogram(aes(y = ..density..), 
                 bins = 15, fill = "#629596", color = "white", alpha = 0.7) +
  labs(
    title = "Distribution of Schooling Years",
    x = "Schooling Years", y = "Frequency"
  ) +
  theme_minimal() 

```

```{r}
#| label: fig-totalExpenditure
#| fig-cap: "The distribution of government expenditure on health as a percentage of total expenditure reflects the level of medical support provided by governments."
#| echo: false
#| warning: false
#| message: false

data_clean <- data %>%
  filter(!is.na(TotalExpenditure) & TotalExpenditure > 0)

ggplot(data_clean, aes(x = TotalExpenditure)) +
  geom_histogram(aes(y = ..density..), 
                 bins = 20, fill = "#5765ad", color = "white", alpha = 0.7) +
  labs(
    title = "Distribution of Government Expenditure on Health",
    x = "Percentage of Health Expenditure as a Percentage of Total Expenditure", y = "Frequency"
  ) +
  theme_minimal() 

```


```{r}
#| label: fig-doctor
#| fig-cap: "The distribution of doctors per 10,000 population, providing an overview of the distribution of medical doctors globally, reflecting general medical resource availability."
#| echo: false
#| warning: false
#| message: false


ggplot(data, aes(x = pct_doctor)) +
  geom_histogram(aes(y = ..density..), 
                 bins = 15, fill = "#8b6fb0", color = "white", alpha = 0.7) +
  labs(
    title = "Distribution of the number of doctors per 10,000",
    x = "Number of medical doctors per 10,000 population", 
    y = "Frequency"
  ) +
  theme_minimal()

```


```{r}
#| label: fig-nursing
#| fig-cap: "The distribution of nurses per 10,000 population, offering a broad view of nurse density worldwide as an indicator of healthcare support."
#| echo: false
#| warning: false
#| message: false

ggplot(data, aes(x = pct_nursing)) +
  geom_histogram(aes(y = ..density..), 
                 bins = 15, fill = "#3f594a", color = "white", alpha = 0.8) +
  labs(
    title = "Distribution of the number of nurses per 10000",
    x = "the number of nurses and  per 10000 population", y = "Frequency"
  ) +
  theme_minimal() 

```
\newpage

# Model {#sec-model}

The goal of this analysis is to construct a linear model to predict life expectancy (`LifeExpectancy`), which represents the average number of years an individual is expected to live. This model incorporates several predictor variables that capture economic and social factors influencing life expectancy.

## Model set-up

The models assume a linear relationship between the predictors and life expectancy, where each predictor contributes independently or interactively to the variation in the outcome variable. Define $y_i$ as the Life Expectancy for country $i$. The factors $x_1$, $x_2$,...represent socioeconomic predictors such as Diphtheria Immunization Coverage, Schooling, Health Expenditure, Number of Doctors and Nurses per 10000, and interaction term.

The linear regression model for developed and developing regions are specified as follows:

```{=tex}

\begin{align*} 
\text{LifeExpectancy}_{\text{developing}} = &\ \beta_0 + \beta_1 \text{Diphtheria Immunization}_i + \beta_2 \text{Schooling}_i + \\
&\ \beta_3 \text{Health Expenditure}_i + \beta_4 \text{Number of Doctors per 10000}_i + \\
&\ \beta_5 \text{Number of Nurses per 10000}_i + \\
&\ \beta_6 \text{Health Expenditure}_i \times \text{Doctors per 10000}_i \times \text{Nurses per 10000}_i + \epsilon_i
\end{align*}
\begin{align*} 
\text{LifeExpectancy}_{\text{developing}} = &\ \beta_0 + \beta_1 \text{Diphtheria Immunization}_i + \beta_2 \text{Schooling}_i + \\
&\ \beta_3 \text{Health Expenditure}_i + \beta_4 \text{Number of Doctors per 10000}_i + \\
&\ \beta_5 \text{Number of Nurses per 10000}_i + \\
&\ \beta_6 \text{Health Expenditure}_i \times \text{Doctors per 10000}_i \times \text{Nurses per 10000}_i + \epsilon_i
\end{align*}

```

Where:

-   `LifeExpectancy`: Represents the average number of years a person is expected to live in a specific country, based on current mortality trends.

-   `Diphtheria Immunization`: The percentage of children who received the diphtheria-tetanus-pertussis (DTP3) vaccine, serving as a proxy for the quality and reach of immunization programs.

-   `Schooling`: Average years of schooling for individuals aged 25 and above, reflecting the level of education in the population.

-   `Health Expenditure`: The percentage of government expenditure allocated to healthcare, indicating the priority given to public health.

-   `Number of Doctors per 10,000`: The availability of medical doctors per 10,000 people, capturing the accessibility of professional healthcare services.

-   `Number of Nurses per 10,000`: The availability of nursing staff per 10,000 people, further representing healthcare capacity.

-   Interaction Term: The combined effect of health expenditure, doctors, and nurses on life expectancy, considering how these variables may amplify or mitigate each other’s impact.

-   epsilon is the error term, assumed to be normally distributed with a mean of 0 and constant variance $ϵ_i​∼N(0,\sigma^2)$

The model assumes that the predictors have a linear relationship with the response variable, i.e., the life expectancy is linearly related to the selected features. We are interested in estimating the coefficients $\beta_1$, $\beta_2$,...,$\beta_4$ which represent the effect of each predictor and interaction term in the outcome.


## Model Justification

The linear regression model was chosen for this analysis due to its simplicity and interpretability. The coefficients from this model directly show how each predictor affects life expectancy, assuming other variables remain constant. This makes it ideal for understanding the impact of healthcare and economic factors on life expectancy in both developed and developing countries.

For the developed countries model, predictors like Diphtheria Immunization, Schooling, Total Expenditure, and the number of Doctors per 10,000 were included. These variables are well-established factors influencing life expectancy in high-income nations [@life_expectancy_who; @world_health_statistics]. In the developing countries model, additional predictors such as Schooling, and healthcare access variables like Doctors and Nurses per 10,000 were added to account for differences in healthcare infrastructure.

Linear regression is suitable for our dataset, as it assumes a normally distributed continuous response variable. While more complex models were considered, linear regression was preferred for its transparency and ease of interpretation, aligning with the goals of this analysis. Additionally, previous studies have shown that healthcare access, education, and economic factors play a significant role in determining life expectancy, particularly in developing countries [@Hanushek2016; @He2020]. Including these predictors ensures the model is built on sound reasoning and established domain knowledge.

## Model Weaknesses and Limitations

The linear regression model used to estimate life expectancy relies on several key assumptions that must be met for valid results. First, it assumes linearity, meaning there is a straight-line relationship between the predictors (e.g., healthcare condition, education levels) and the outcome variable (`life expectancy`). This assumption ensures that a change in a predictor corresponds to a consistent change in life expectancy. Second, the model assumes that the errors are uncorrelated, meaning the residuals do not exhibit any patterns when plotted. This assumption is significant for making accurate inferences, such as significance tests and confidence intervals. Third, the model assumes homoscedasticity, which means that the variance of the residuals should remain constant across all values of the predictors. This assumption helps avoid bias in estimating the relationship between the predictors and the outcome variable. Fourth, the residuals should follow a normal distribution. This assumption is necessary for performing accurate hypothesis tests and for generating valid confidence intervals, which provide insights into the uncertainty of the model's predictions. Lastly, it is important that the model does not appear multicollinearity, where predictors are highly correlated with each other. These assumptions provide a foundation for the model, violations can lead to misleading results with inaccurate coefficients.

However, several limitations apply to this model. Despite the assumption of linearity, real-world relationships between life expectancy and its predictors may be more complex or non-linear, and such complexity would not be fully captured by this model. For instance, the effect of economic development on life expectancy may vary significantly at different levels of income. Moreover, while the model assumes uncorrelated errors, there may be factors that influence both the predictors and life expectancy, leading to correlated residuals. For example, social determinants like income inequality or access to healthcare might impact both education and life expectancy, potentially violating the assumption of independence. The assumption of constant variance also has limitations, as certain groups (e.g., countries with lower health expenditure) may have more variability in life expectancy than others, potentially leading to not constant variance. Additionally, the assumption of normally distributed errors may not hold in all cases, especially when extreme outliers (such as countries with unusual life expectancy rates) are present in the data.

Other external factors not accounted for in this model may also influence life expectancy. Environmental factors like climate change, sudden public health crises (e.g., pandemics), and political instability could have significant effects on life expectancy, yet these factors may not be included as predictors in the model. These limitations should be considered when interpreting the model’s results, particularly when applying the findings to specific populations or making broad predictions.

## Model Validation

The models for both Developed and Developing countries were implemented using R, with applying out-of-sample testing, the data was randomly split into training and test sets, with 80% used for training the model and 20% reserved for testing. This allows us to assess how well the model performs on data that was not used during training. The Root Mean Square Error (RMSE) was calculated for each model to evaluate the performance and generalization to unseen data. A lower RMSE indicates better predictive performance.

In @tbl-keyestimates, the Developed model is more efficient and better fitted primarily due to its higher R² (64.5% vs 51.5%), indicating that it explains a greater proportion of variance in life expectancy. Additionally, its RMSE value is lower (3.76 vs 4.94), showing more precise predictions. The Developing model has a larger sample size and variability, which might have diluted the effect of individual predictors. The better fit of the Developed model is partly due to the smaller, more homogeneous sample, allowing it to provide more reliable estimates with fewer outliers.

Extended versions of these tables can be found in @tbl-additionaltable

# Results {#sec-results}

```{r}
#| echo: false
#| label: tbl-modelresults
#| tbl-cap: "The prediction table indicates that the average life expectancy in developed countries is 78.52 years, while in developing countries, it is slightly lower at 71.67 years. This difference of approximately 5.1 years in life expectancy suggests a significant health and infrastructure disparity between developed and developing countries. These results align with broader global trends where developed countries typically benefit from better healthcare systems, higher standards of living, and developed medical technology, contributing to longer life expectancies. "
#| eval: true
#| warning: false
#| message: false

# load data and model
lm_developed <- readRDS(here::here("models/lm_developed.rds"))
lm_developing <- readRDS(here::here("models/lm_developing.rds"))

# make predictions
data <- data %>%
  mutate(
    PredictedDeveloped = predict(lm_developed, newdata = data),
    PredictedDeveloping = predict(lm_developing, newdata = data)
  )

# median and average predictions
results <- data %>%
  summarise(
    AverageDeveloped = mean(PredictedDeveloped, na.rm = TRUE),
    AverageDeveloping = mean(PredictedDeveloping, na.rm = TRUE)
  )

# display avg percent and normalized percent
results %>%
  select(AverageDeveloped, AverageDeveloping) %>%
  kable(
    col.names = c("Average Life Expectancy in Developed Countries", "Average Life Expectancy in Developing Countries"),
    digits = 2,
    booktabs = TRUE
  ) %>%
  kable_styling(
    latex_options = c("striped", "scale_down")
  )

```

```{r}
#| label: tbl-keyestimates
#| tbl-cap: "Summary of key model estimates for Developed and Developing counties, including coefficients for predictors like Diphtheria, Schooling, and TotalExpenditure, pct_doctor, pct_nursing, with standard errors for each estimate. Model performance statistics, such as sample size, R², and adjusted R², are also displayed."
#| echo: false
#| eval: true
#| warning: false
#| message: false

# load data and model
lm_developed <- readRDS(here::here("models/lm_developed.rds"))
lm_developing <- readRDS(here::here("models/lm_developing.rds"))

model_list <- list("Model for Developed" = lm_developed, "Model for Developing" = lm_developing)
modelsummary(model_list, 
             output = "kableExtra", 
             statistic = "std.error", 
             coef_map = c("Diphtheria" = "Diphtheria Immunization",
                          "Schooling" = "Schooling",
                          "TotalExpenditure" = "Health Expenditure",
                          "pct_doctor" = "Number of Medical Doctors per 10000",
                          "pct_nursing" = "Number of Nurses per 10000")) %>%
  kable_styling(latex_options = c("striped", "scale_down"))
```

```{r}
#| echo: false
#| eval: true
#| label: fig-resultsplot
#| fig-cap: "The prediction plots demonstrate that life expectancy in developed countries tends to remain higher with less variance, indicating stability in health outcomes due to better healthcare systems, more consistent access to medical services, and overall economic stability with less variance. In contrast, the life expectancy in developing countries exhibits a broader range of variation, with a more rapid growth trajectory. This suggests that while life expectancy is increasing in these countries, it is influenced by a variety of factors such as improvements in healthcare, economic development, and access to resources, all of which vary more significantly across different regions."
#| warning: false
#| message: false

lm_developed <- readRDS(here::here("models/lm_developed.rds"))
lm_developing <- readRDS(here::here("models/lm_developing.rds"))

# Make predictions
data <- data %>%
  mutate(
    PredictedDeveloped = predict(lm_developed, newdata = data),
    PredictedDeveloping = predict(lm_developing, newdata = data),
  )

# Reshape data for plotting
plot_data <- data %>%
  select(Year, PredictedDeveloped, PredictedDeveloping) %>%
  pivot_longer(
    cols = c(PredictedDeveloped, PredictedDeveloping),
    names_to = "Status",
    values_to = "PredictedLifeExpectancy"
  ) %>%
  mutate(Status = case_when(
    Status == "PredictedDeveloped" ~ "Developed",
    Status == "PredictedDeveloping" ~ "Developing"
  ))

ggplot(plot_data, aes(x = Year, y = PredictedLifeExpectancy, color = Status)) +
  geom_smooth(method = "loess", se = TRUE, size = 1) +
  labs(
    title = "Predicted Life Expectancy Over Time",
    x = "Year",
    y = "Predicted Life Expectancy (Years)",
    color = "Status"
  ) +
  scale_color_manual(values = c("Developed" = "brown", "Developing" = "darkgreen")) +
  theme_minimal() +
  theme(
    text = element_text(size = 12),
    legend.position = "top"
  )

```

\newpage


The predicted life expectancy distributions across various predictors reveal important trends. Longer schooling years[@fig-schoolgroups] strongly correlate with higher predicted life expectancy, emphasizing the positive impact of education. High diphtheria immunization coverage[@fig-diphtheria-groups] is also associated with increased life expectancy, though this relationship is less consistent for medium and low coverage levels, indicating variability in its predictive contribution. Similarly, higher government health expenditure[@fig-totalexpenditure-groups] aligns with greater life expectancy, while lower expenditure shows limited variability in predicted outcomes. Lastly, the distribution of medical professionals[@fig-doctornursing-groups] highlights that developed medical conditions generally contribute to higher life expectancy, though some variability in their influence remains.

```{r}
#| echo: false
#| eval: true

# Load the model
lm_overall <- readRDS(here::here("models/lm_overall.rds"))

# Generate predictions
prediction_data <- data %>%
  filter(!is.na(Diphtheria) & !is.na(TotalExpenditure) & !is.na(Schooling) & !is.na(pct_doctor) & !is.na(pct_nursing))

prediction_data$predictedLifeExpectancy <- predict(lm_overall, newdata = prediction_data)

```

```{r}
#| echo: false
#| eval: true
#| label: fig-schoolgroups
#| fig-cap: "The distribution shows how different levels of education correlate with predicted life expectancy, highlighting group-wise distribution and variability."
#| warning: false
#| message: false

# Remove rows with 0 or NULL values in Schooling
prediction_data <- prediction_data %>%
  filter(!is.na(Schooling) & Schooling > 0)

# Create Schooling year groups for segmentation
prediction_data$schooling_years <- cut(
  prediction_data$Schooling,
  breaks = c(3.1, 6.1, 12.1, 15.1, 18.1, 21),
  labels = c("3-6", "6-12", "12-15", "15-18", "18-21")
)

# Violin plot
ggplot(prediction_data, aes(x = schooling_years, y = predictedLifeExpectancy, fill = schooling_years)) +
  geom_violin(alpha = 0.6, trim = FALSE) + # Violin plot for distribution
  scale_fill_manual(
    values = c("3-6" = "blue", "6-12" = "green", "12-15" = "orange", "15-18" = "purple", "18-21" = "red"),
    name = "Schooling Year Groups"
  ) +
  labs(
    title = "Predicted Life Expectancy by Schooling Year Groups",
    x = "Schooling Year Groups",
    y = "Predicted Life Expectancy (years)"
  ) +
  theme_minimal()

```

```{r}
#| echo: false
#| eval: true
#| label: fig-diphtheria-groups
#| fig-cap: "The distribution illustrates how varying immunization coverage levels contribute to differences in predicted life expectancy."
#| warning: false
#| message: false

# Create Diphtheria coverage groups
prediction_data$Diphtheria_groups <- cut(prediction_data$Diphtheria,
  breaks = c(0, 30, 60, 100),
  labels = c("0-30", "30-60", "60-100")
)

# Plot predicted life expectancy by Diphtheria groups using density plot
ggplot(prediction_data, aes(x = predictedLifeExpectancy, fill = Diphtheria_groups)) +
  geom_density(alpha = 0.7, adjust = 1.5) +  # Density plot to show distribution
  scale_fill_manual(
    values = c("0-30" = "royalblue", "30-60" = "lightgreen", "60-100" = "orange"),
    name = "Diphtheria Coverage Groups"
  ) + # Custom colors for each group
  labs(
    title = "Predicted Life Expectancy Across Diphtheria Coverage Groups",
    x = "Predicted Life Expectancy (years)",
    y = "Density"
  ) +
  theme_minimal() +
  theme(legend.position = "right")  # Place legend on the right

```

```{r}
#| echo: false
#| eval: true
#| label: fig-totalexpenditure-groups
#| fig-cap: "The distribution reveals the distribution of predicted life expectancy across health expenditure levels, showing central tendencies and variability."
#| warning: false
#| message: false

# Group TotalExpenditure
prediction_data$TotalExpenditure_groups <- cut(
  prediction_data$TotalExpenditure,
  breaks = c(1.1, 4.26, 6.1, 7.98, 14.4),
  labels = c("1.1-4.26", "4.26-6.1", "6.1-7.98", "7.98+")
)

# Boxplot for TotalExpenditure groups with empty fill and colored stroke
ggplot(prediction_data, aes(x = TotalExpenditure_groups, y = predictedLifeExpectancy, color = TotalExpenditure_groups)) +
  geom_boxplot(
    fill = "white",  # Set the box fill to be empty (white)
    alpha = 0.7     # Adjust transparency for the box outline
  ) +
    stat_summary(fun = "mean", geom = "point", shape = 16, size = 2, color = "brown") +  # Highlight the mean
  scale_color_manual(
    values = c("1.1-4.26" = "purple", "4.26-6.1" = "royalblue", "6.1-7.98" = "orange", "7.98+" = "lightcoral"),
    name = "Health Expenditure Groups"
  ) +
  labs(
    title = "Predicted Life Expectancy by Health Expenditure Groups",
    x = "Health Expenditure Groups",
    y = "Predicted Life Expectancy (years)"
  ) +
  theme_minimal() +
  theme(legend.position = "right")  # Place legend on the right

```

```{r}
#| echo: false
#| eval: true
#| label: fig-doctornursing-groups
#| fig-cap: "The distribution demonstrates the relationship between medical professional availability (doctors and nurses) and predicted life expectancy, highlighting patterns across groups."
#| warning: false
#| message: false

# Categorize predictedLifeExpectancy based on min, median, mean, and max values
prediction_data$life_expectancy_group <- cut(prediction_data$predictedLifeExpectancy,
  breaks = c(42.3, 60, 72.9, 80, 89),  # Define the breaks
  labels = c("42.3-60", "60-72.9", "72.9-80", "80-89"),  # Labels for each group
  include.lowest = TRUE
)

# Plot with custom colors for the life expectancy groups
ggplot(prediction_data, aes(x = pct_doctor, y = pct_nursing, color = life_expectancy_group)) +
  geom_point(alpha = 0.7, size = 2) +  # Scatter plot with points, color based on life expectancy groups
  scale_color_manual(values = c("42.3-60" = "brown", "60-72.9" = "darkgreen", "72.9-80" = "orange", "80-89" = "purple")) +  # Custom colors for each life expectancy group
  labs(
    title = "Predicted Life Expectancy by Pct Doctor and Pct Nursing",
    x = "the number of doctors per 10000",
    y = "the number of nurses per 10000",
    color = "Life Expectancy Groups"
  ) +
  theme_minimal() +
  theme(legend.position = "right")  # Position the legend on the right side

```

\newpage


# Discussion {#sec-discussion}

## Factors Influencing Life Expectancy Across Nations {#sec-first-point}

The study aims to develop a model for predicting life expectancy based on healthcare, economic, and educational factors. By analyzing the relationship between these predictors and actual life expectancy, we gain insights into the factors that influence life expectancy outcomes and evaluate the model's predictive performance.

A comparison of predicted life expectancy distributions reveals several notable trends. Longer schooling years[@fig-schoolgroups] strongly correlate with higher life expectancy, highlighting the critical role of education. High diphtheria immunization coverage[@fig-diphtheria-groups] generally predicts greater life expectancy, though medium and low coverage levels exhibit variability, suggesting that immunization is not the sole or dominant factor. Similarly, higher government health expenditure[@fig-totalexpenditure-groups] aligns with improved outcomes, while lower spending shows minimal variation. Availability of doctors and nurses[@fig-doctornursing-groups] also indicates a positive relationship with life expectancy, though some variability suggests other contributing factors are at play.

These findings align with prior research, demonstrating that healthcare and education are pivotal in shaping life expectancy. The model effectively captures these relationships, offering valuable insights for addressing disparities between developed and developing nations.

## Educational and Healthcare Factors as Significant Predictors

A key finding of this study is the distinct roles that educational and healthcare factors play in predicting life expectancy across developed and developing countries. In the model for developed nations, schooling is a significant positive predictor (0.645), though its impact is less pronounced compared to developing nations (1.694). This suggests that while education universally contributes to longer life expectancy, its influence is more significant in countries where educational access is still expanding.

Healthcare variables show contrasting trends between the two groups. Health expenditure negatively correlates with life expectancy in both contexts but is more substantial in developed countries (−1.740) compared to developing countries (−0.352). This reflects diminishing returns on investment in already developed healthcare systems in developed nations, where additional spending may not yield proportional gains in life expectancy. Similarly, the availability of medical doctors demonstrates a divergent impact, showing a negative association in developed nations (−0.446) but a positive one in developing nations (0.444). This suggests that increasing access to medical professionals is a more critical driver of life expectancy in developing regions, where healthcare systems are less established.

These findings highlight the nuanced roles of education and healthcare in shaping life expectancy, emphasizing the need for tailored policy approaches to address disparities across nations.

## Variance in Life Expectancy and the Influence of Social Factors

The analysis underscores significant disparities in life expectancy variance between developed and developing countries, shaped by both systemic and social factors. In developed nations, life expectancy remains higher with less variance, a reflection of robust healthcare infrastructure, widespread access to medical services, and economic stability. These advantages are complemented by stronger social support systems, higher education levels, and improved public health awareness, which collectively enhance the consistency of health outcomes.

In contrast, developing countries exhibit greater variability in life expectancy, driven by a complex interplay of economic growth, healthcare access, and social determinants such as education and community infrastructure. Regions with better access to schooling and healthcare services tend to show faster life expectancy improvements, while others lag behind due to inequities in resource distribution and social support. This dynamic highlights the dual role of economic and social factors in shaping life expectancy trends, underscoring the need for comprehensive policies that prioritize education, equitable healthcare, and community development to reduce disparities and foster sustainable progress.

## Weaknesses and Next Steps

One limitation of the current model is the exclusion of other potential factors that could influence life expectancy. While the model includes several key predictors like schooling, health expenditure, and the number of medical professionals, it does not account for other significant variables such as social determinants of health (e.g., income inequality, access to social services, or political stability), which could have a notable impact, particularly in developing countries. Environmental factors such as air quality, climate change, and water sanitation also play critical roles, especially in low-income regions, yet these were not included in the model. Additionally, there is the potential for bias in the dataset itself. If the dataset used for training the model is not representative of all countries, particularly those with unique socio-economic or healthcare challenges, it could limit the model’s generalizability. Bias could also arise if the data predominantly reflects developed nations, where healthcare systems and economic factors are more consistent, leading to skewed predictions for developing countries.

Future research should explore several avenues to improve the model. First, expanding the dataset to include additional variables, such as policies related to social welfare, political stability, and government regulations, would provide a more comprehensive view of the factors influencing life expectancy. Incorporating data on policy changes or government reforms that impact healthcare and social services could also enrich the model's predictive power. Another area for future research could involve exploring the impact of environmental factors, such as pollution levels, access to clean water, and geographical conditions. These variables are especially relevant in developing countries and could reveal new insights into life expectancy trends. By addressing these limitations and exploring these additional variables, future research can refine models of life expectancy and improve predictions for countries at various stages of economic and healthcare development.

# Appendix {-}

## Data cleaning {#sec-data-clean}

To prepare the dataset for analysis, I followed these steps:

1. Column Selection and Formatting: Removed irrelevant columns, such as administrative codes, and reformatted the "Year" column into a standardized four-digit format (YYYY) for consistency. Created a "Health_Care_Access" score by aggregating scaled values for "Medical Doctors per 10,000" and "Health Expenditure" to enable focused analysis.

2. Handling Missing Values and Grouping Categories: Addressed missing values in key variables like "Schooling" and "Health Expenditure" by applying group-wise median imputation based on development status (Developed or Developing). For categorical fields like "Status," missing entries were labeled as "Unknown." Countries with over 50% incomplete data were excluded, while less common regions were grouped into an "Other Regions" category to simplify comparisons.

3. Adding New Columns: Created a "Health_Care_Access" score by aggregating scaled values for "Medical Doctors per 10,000" and "Nurses per 10,000" Added a binary "Developed_Status" column, encoding 1 for developed countries and 0 for developing countries, based on established World Bank classifications.

4. Outlier Detection and Export: Verified and handled outliers in "Health Expenditure" and "Life Expectancy" using interquartile range (IQR) thresholds. The cleaned dataset was exported in both CSV and Parquet formats for efficient storage and compatibility with developed tools.

## Idealized Methodology

### **Population, Frame, and Sample**

The population for this study encompasses all individuals worldwide whose life expectancy is influenced by various socioeconomic, healthcare, and environmental factors. This includes individuals living in developed and developing countries, spanning different ages, genders, and social groups.

The frame consists of a comprehensive dataset of individuals with demographic, healthcare, and socioeconomic information relevant to life expectancy. This dataset could be sourced from global organizations such as the World Health Organization (WHO), World Bank, or national statistical agencies. The frame should ideally include recent data to capture current trends and factors affecting life expectancy.

The sample would be a representative subset of individuals drawn from the frame, stratified by development status (Developed or Developing), age groups, and regions. This stratification ensures diversity and allows for comparisons across different demographics. The sample should include sufficient representation from high-variance populations, such as those in regions undergoing rapid economic or healthcare changes, to enhance the model's predictive accuracy.

### **Sample Recruitment**

-   **Recruitment via National and Global Surveys**: Individuals could be recruited through existing national and international health surveys, such as those conducted by the World Health Organization (WHO), World Bank, or national census bureaus. Participants would be invited to contribute additional data on healthcare access, education levels, and socioeconomic factors relevant to life expectancy.

-   **Collaboration with Healthcare Providers**: Healthcare facilities, including hospitals and clinics, could assist in recruiting participants by inviting patients to contribute anonymized health data for research purposes. Recruitment could occur during routine health check-ups or through online health portals.

-   **Community Outreach Programs**: Recruitment could target communities through local organizations, NGOs, and social programs. These efforts could focus on ensuring representation from underrepresented or high-variance populations, such as rural areas or rapidly developing regions.

-   **Incentives**: Participants could be incentivized with benefits such as access to personalized health reports, free health screenings, or community-based health initiatives to improve overall participation rates.

-   **Digital Platforms**: Online platforms like health-focused apps, educational websites, and social media groups could provide an avenue for researchers to engage potential participants and collect survey data. These platforms are especially useful for reaching younger or tech-savvy demographics.

### **Sampling Approach**

The study employs a stratified random sampling method, dividing the population into strata based on key factors that influence life expectancy, such as geographic region (e.g., developed vs. developing countries), age group (e.g., 0-20, 21-40, 41-60, 61+), income level (low, middle, high), and access to healthcare (e.g., urban, suburban, rural). This ensures that the sample represents diverse subgroups affecting life expectancy outcomes. For instance, suppose the study aims to collect data from 1,200 respondents. If stratification assigns 50% of the sample to developed countries and 50% to developing countries, with age distribution set at 20% for 0-20, 30% for 21-40, 30% for 41-60, and 20% for 61+, then 180 participants from developed countries would be aged 21-40. Further stratification could divide these respondents by income level, where 40% fall under the high-income bracket, equating to 72 participants.

-   **Representativeness**: Stratified sampling ensures that the sample reflects the variability in life expectancy determinants, enabling more precise insights into how different factors (e.g., healthcare access, socioeconomic status) influence outcomes.

-   **Precision**: By ensuring balanced representation from various subgroups, this approach minimizes biases and provides clearer insights into the differences between demographic or regional groups.

-   **Complexity**: The need to define and categorize strata, particularly in diverse populations, can make stratified sampling more complex to implement. For example, defining healthcare accessibility uniformly across regions may be challenging.

-   **Cost and Logistics**: Stratified sampling may involve higher costs and more administrative effort, particularly in reaching underrepresented or remote populations. Recruitment and data collection across strata could also take longer compared to simpler methods like random or convenience sampling.

### **Non-response handling**

Non-response occurs when individuals or groups do not provide their data, fail to complete surveys, or are otherwise unavailable for participation. Effectively managing non-response is significant to preserving the representativeness and reliability of the findings.

-   **Follow-up Invitations**: If participants do not respond initially, reminders can be sent via email, phone calls, or community leaders. Personalized messages highlighting the importance of their input to public health and societal improvements may encourage participation.

-   **Weighting for Non-Response**: Statistical weighting can be applied if certain demographics (e.g., rural residents, lower-income groups) have higher non-response rates. Adjusting weights ensures that these groups are proportionally represented in the analysis, mitigating potential biases.

-   **Adjustment**: If systematic non-response is identified (e.g., fewer responses from regions with limited internet access), additional data collection efforts in these areas or adjustments during analysis using statistical techniques like imputation can be employed to fill gaps.

-   **Engaging Local Organizations**: Partnering with local health agencies or NGOs in areas with traditionally low participation can foster trust and improve response rates.

### **Standards for the Questionaires**

-   **More Context**: Participants could be asked to provide detailed information on factors influencing life expectancy, such as diet, physical activity levels, access to healthcare, occupational hazards, and exposure to pollution. Including such variables could enhance the model's ability to capture key influences beyond demographic or geographic data.

-   **Flexibility**: The questionnaire could utilize a mix of open-ended and scaled questions to gather both quantitative and qualitative insights. This design would allow participants to elaborate on unique life circumstances or local conditions that may not be captured in structured questions.

-   **Self-Reporting Bias**: A significant limitation of questionnaires is the tendency for self-reporting bias. Participants might overestimate healthy behaviors, such as exercise or nutritious eating, or underreport harmful habits like smoking or alcohol consumption. This could distort the findings and reduce model accuracy.

## Idealized Survey

A sample survey can be found at: <https://forms.gle/Jzpw6MR5hXgnAfiDA>

This survey is conducted as part of a research study to explore how various factors—such as healthcare condition, immunization coverage, and education—impact life expectancy, providing valuable insights into their relationship with overall health outcomes in your community. It includes questions about your healthcare experiences, education, and awareness of health initiatives. Your responses will remain completely anonymous, and no personal data will be shared or used beyond this research. This survey should take 5 to 7 minutes to complete. Thank you for taking the time to share your insights.

**Survey Coordinator**: KarmenZhu\
**Email**: karmen.zhu\@mail.utoronto.ca

**Section 1: Personal Information**

**1. Please select your age group:**(Select one)

-   Under 20

-   20-29

-   30-39

-   40-49

-   50-59

-   60 or older

**2. What is your country of residence? **

-  (please specify):\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

**3. What is your highest level of education completed or currently pursuing?** (Select one)

-   No formal education

-   Primary school

-   High school diploma

-   Some college/university

-   Bachelor’s degree

-   Master’s degree

-   Doctoral degree (e.g., Ph.D.)

-   Professional degree (e.g., MD, JD, MBA)

-   Other (please specify): \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

**4. What is your primary occupation?** (Select one)

-   Full-time employed

-   Part-time employed

-   Self-employed

-   Student

-   Retired

-   Other (please specify): \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

**Section 2: Health and Healthcare Information**

**5. Have you received a diphtheria immunization in the past 10 years?** (Select one)

-   Yes

-   No

-   I don’t know

**6. What is the approximate distance to the nearest healthcare facility (e.g., clinic, hospital)?** (Select one)

-   Less than 5 km (3 miles)

-   5-10 km (3-6 miles)

-   11-20 km (7-12 miles)

-   More than 20 km (12 miles)

**7. How many walking-distance clinics or hospitals are located near your home?** (Select one)

-   None

-   1-2

-   3-4

-   5 or more

**8. How long do you typically wait to receive care at a government healthcare facility?** (Select one)

-   Less than 1 hour

-   1-3 hours

-   3-6 hours

-   More than 6 hours

**9. How much of your medical expenses (e.g., doctor visits, hospital stays, medication) does your health insurance cover?**

-   (please specify):\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

**10. How much of your monthly income is spent on healthcare (including insurance, out-of-pocket expenses, etc.)?** (Select one)

-   Less than 5%

-   5-10%

-   11-20%

-   More than 20%

**11. Do you have a family doctor? If so, how often do you visit your family doctor?** (Select one)

-   never

-   Rarely (Once a year)

-   2–3 times a year

-   More than 3 times a year

**Final Section**

Thank you for completing this survey! Your responses will help improve public health initiatives.


## Additional Tables & Figures

```{r}
#| label: tbl-additionaltable
#| tbl-cap: Summary of the Life Expectancy model, which includes key variables such as schooling years and the percentage of government health expenditure. The table presents the model coefficients along with their standard errors.
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Load the model
lm_overall <- readRDS(here::here("models/lm_overall.rds"))

# Extract summary statistics using broom
coefficients_df <- tidy(lm_overall) %>%
  mutate(
    Term_Type = "Linear"  # Add a column specifying term type
  )

# Clean and format the Term column
coefficients_df <- coefficients_df %>%
  mutate(
    term = gsub("[^[:alnum:]_\\s]", "", term)  # Remove special characters
  )

# Select only the required columns
coefficients_cleaned <- coefficients_df %>%
  select(term, estimate, std.error, statistic, p.value, Term_Type) %>%
  rename(
    Term = term,
    Estimate = estimate,
    `Std. Error` = std.error,
    `t Value` = statistic,
    `Pr(>|t|)` = p.value
  )

# Create the final table
kable(
  coefficients_cleaned,
  format = "html",
  col.names = c("Term", "Estimate", "Std. Error", "t Value", "Pr(>|t|)", "Term_Type"),
  digits = 3,
  caption = "Summary of the Life Expectancy model with key predictors and their contributions."
)

```

\newpage

# References